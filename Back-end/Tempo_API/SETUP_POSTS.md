# Настройка функциональности создания постов для Instagram

## Шаги настройки

### 1. Добавьте API ключи в `.env` файл

Откройте файл `Back-end/Tempo_API/Tempo_API/.env` и добавьте:

```env
# Mistral AI настройки (уже предоставлены)
MISTRAL_API_KEY=AwBdCR0tAxsXZBzfQtRtViHzJcSK63dO
MISTRAL_API_URL=https://api.mistral.ai/v1/chat/completions
MISTRAL_MODEL=mistral-small-latest
```

**Примечание:** Генерация изображений теперь выполняется на клиенте через Puter.js, поэтому API ключи для генерации изображений не требуются!

### 2. Убедитесь, что папки созданы

При первом запуске приложение автоматически создаст:
- `wwwroot/posts/` - для JSON файлов с постами
- `wwwroot/uploads/posts/` - для загруженных изображений

### 3. Puter.js уже подключен

Puter.js автоматически подключен в `index.html` фронтенд-приложения. Никаких дополнительных настроек не требуется - генерация изображений работает бесплатно и без API ключей!

### 4. Перезапустите бекенд

После добавления переменных окружения перезапустите бекенд приложение.

## Использование

### В приложении для персонала (tempo_workers)

1. Войдите в систему как администратор
2. В меню слева нажмите на "AI Посты"
3. Нажмите "Создать пост"
4. Выберите блюдо из списка
5. Выберите источник изображения:
   - **Сгенерировать через AI (Puter.js)** - изображение будет создано через Puter.js (бесплатно, без API ключей)
     - Выберите модель генерации (DALL-E 3, GPT Image, Gemini, Flux, Stable Diffusion и др.)
   - **Загрузить свое изображение** - загрузите файл с компьютера
6. Нажмите "Создать"

Пост будет создан с:
- Текстом, сгенерированным через Mistral AI
- Изображением (сгенерированным через Puter.js или загруженным)
- Информацией о блюде

**Доступные модели генерации изображений:**
- DALL-E 3 (HD) - высокое качество
- DALL-E 2
- GPT Image 1
- Gemini 2.5 Flash
- Flux.1 Schnell - быстрая генерация
- Flux 1.1 Pro - профессиональное качество
- Stable Diffusion 3

### API Endpoints

- `POST /api/Post` - создать пост
- `GET /api/Post` - получить все посты
- `GET /api/Post/{id}` - получить пост по ID
- `DELETE /api/Post/{id}` - удалить пост

## Структура файлов

### Бекенд
- `Tempo_BLL/Services/MistralAIService.cs` - сервис для работы с Mistral AI
- `Tempo_BLL/Services/DeepAIService.cs` - сервис для работы с DeepAI
- `Tempo_BLL/Services/PostService.cs` - основной сервис для управления постами
- `Tempo_API/Controllers/PostController.cs` - контроллер API
- `Tempo_API/DTOs/PostDtos/` - DTO для постов

### Фронтенд
- `tempo_workers/src/pages/postPage/PostPage.tsx` - страница создания постов
- `tempo_workers/src/api/PostApi.ts` - API клиент для работы с постами

## Хранение данных

Посты сохраняются как JSON файлы в папке `wwwroot/posts/`. Каждый пост - отдельный файл с именем `{id}.json`.

Структура JSON:
```json
{
  "id": "guid",
  "dishName": "Название блюда",
  "text": "Текст поста",
  "imageUrl": "URL изображения",
  "createdAt": "2024-01-01T00:00:00Z"
}
```

## Устранение проблем

### Ошибка "MISTRAL_API_KEY not found"
- Убедитесь, что переменная добавлена в `.env` файл
- Перезапустите бекенд

### Ошибка генерации изображения через Puter.js
- Убедитесь, что скрипт Puter.js загружен (проверьте `index.html`)
- Попробуйте другую модель генерации
- Проверьте консоль браузера на ошибки
- Обновите страницу и попробуйте снова

### Изображения не отображаются
- Убедитесь, что `UseStaticFiles()` добавлен в `Program.cs`
- Проверьте, что папка `wwwroot` существует
- Проверьте CORS настройки для статических файлов

### Посты не создаются
- Проверьте консоль браузера на ошибки
- Проверьте логи бекенда
- Убедитесь, что блюда есть в базе данных

